<!DOCTYPE HTML>
<html>
	<head>
		<title>De bijenkast van binnen</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body>

		<!-- Header -->
			<header id="header" class="alt">
				<div class="logo"><a href="index_c00001_d031.html"><span>Home</span></a></div>
				<button id="honey-jar-btn" class="honey-jar-btn" style="display:none; white-space:normal; text-align:center; word-break:break-word; max-width: 180px; width: 90%; min-width: 100px; margin: 0 auto; line-height: 1.1; padding: 0.35em 0.5em; font-size: 1em; vertical-align: middle; align-items: center; justify-content: center; height: auto; min-height: 2.2em; overflow-wrap: break-word;">
          <span id="honey-jar-amount" style="display:block;"></span>
          <span id="honey-jar-details" style="display:block;"></span>
        </button>
				<div id="honey-order-modal" class="honey-order-modal" style="display:none;">
				  <div class="honey-order-modal-content" style="max-height:90vh; overflow-y:auto;">
				    <button class="honey-order-modal-close" id="honey-order-modal-close">&times;</button>
				    <h2 id="honey-order-title">Honing bestellen bij de imker</h2>
				    <p class="honey-info">Heerlijke lokale honing, direct van de imker!</p>
				    <div id="honey-information" style="margin-bottom:0.7em; color:#ffd600; font-weight:500; display:none;"></div>
				    <form id="honey-order-form">
				      <label for="honey-amount">Aantal potten:</label>
				      <input type="number" id="honey-amount" name="honey-amount" min="1" max="99" required>
				      <div id="honey-total" style="margin-bottom:0.5em; color:#ffd600; font-weight:600;"></div>
				      <label for="honey-delivery">Afleveroptie:</label>
				      <select id="honey-delivery" name="honey-delivery">
				        <option value="pickup">Afhalen bij de imker</option>
				      </select>
				      <div id="honey-address-fields" style="display:none; margin-top:0.5em;">
				        <label for="honey-address">Adres:</label>
				        <input type="text" id="honey-address" name="honey-address" maxlength="120">
				        <label for="honey-postcode">Postcode:</label>
				        <input type="text" id="honey-postcode" name="honey-postcode" maxlength="12">
				        <label for="honey-city">Plaats:</label>
				        <input type="text" id="honey-city" name="honey-city" maxlength="40">
				      </div>
				      <label for="honey-name">Naam (optioneel):</label>
				      <input type="text" id="honey-name" name="honey-name" maxlength="60">
				      <label for="honey-email">E-mail (optioneel):</label>
				      <input type="email" id="honey-email" name="honey-email" maxlength="80">
				      <button type="button" id="honey-order-review" class="honey-order-submit">Verder</button>
				    </form>
				    <div id="honey-order-review-summary" class="honey-order-review-summary" style="display:none;"></div>
				    <div class="honey-order-disclaimer">
				      Uw gegevens worden niet door ons opgeslagen, maar rechtstreeks doorgestuurd naar de imker. Wij verzorgen geen betaling â€” regel betaling en afhaling rechtstreeks met de imker. Wij zijn niet aansprakelijk voor foutieve informatie over de verkoop of voor eventuele problemen bij betaling of levering. Neem bij vragen of problemen contact met ons op.
				    </div>
				    <div id="honey-order-confirm" class="honey-order-confirm" style="display:none;"></div>
				  </div>
				</div>
				<a href="#menu">Menu</a>
			</header>

		<!-- Nav -->
			<nav id="menu">
				<ul class="links">
					<li><a href="index_c00001_d031.html">Home</a></li>
					<li><a href="locaties.html">Locaties</a></li>
					<li><a href="bijen.html">Bijen</a></li>
					<li><a href="vegetatie.html">Vegetatie</a></li>
					<li><a href="information.html">Informatie</a></li>
				</ul>
			</nav>

		<!-- Banner Section -->
			<section class="banner half">
				<article>
					<img id="banner-img-1" src="images/c00001_d031_1.jpg" alt="" />
					<div class="inner">
						<header>
							<p id="banner-text-1">Het bijenvolk</p>
							<h2 style="font-size:1.2em;">In de buiten lucht</h2>
						</header>
					</div>
				</article>
				<article>
					<img id="banner-img-2" src="images/c00001_d031_2.jpg" alt="" />
					<div class="inner">
						<header>
							<p id="banner-text-2">Het bijenvolk</p>
							<h2 style="font-size:1.2em;">In de buiten lucht</h2>
						</header>
					</div>
				</article>
				<article>
					<img id="banner-img-3" src="images/c00001_d031_3.jpg" alt="" />
					<div class="inner">
						<header>
							<p id="banner-text-3">Het bijenvolk</p>
							<h2 style="font-size:1.2em;">In de buiten lucht</h2>
						</header>
					</div>
				</article>
				<article>
					<img id="banner-img-4" src="images/c00001_d031_4.jpg" alt="" />
					<div class="inner">
						<header>
							<p id="banner-text-4">Het bijenvolk</p>
							<h2 style="font-size:1.2em;">In de buiten lucht</h2>
						</header>
					</div>
				</article>
				<article>
					<img id="banner-img-5" src="images/c00001_d031_5.jpg" alt="" />
					<div class="inner">
						<header>
							<p id="banner-text-5">Het bijenvolk</p>
							<h2 style="font-size:1.2em;">In de buiten lucht</h2>
						</header>
					</div>
				</article>
			</section>
 
<!-- Zero -->
			<section id="zero" class="wrapper style3">
				<div class="inner">
					<header class="align-center">
					    <div id="bee-advice-container" class="bee-advice-container" style="display:none;">
					        <img src="images/bee.png" alt="Bee" class="bee-advice-img" />
					        <div class="bee-advice-bubble" id="bee-advice-text">De bij werkt aan een update...</div>
					    </div>
					    <p><strong>Status:</strong> <span id="status">Verbinden...</span></p>
					    <input type="text" id="message" placeholder="Stel een vraag aan het bijenvolk?">
					    <p class="disclaimer">Uw vraag wordt doorgestuurd naar een AI-model (ChatGPT). De vraag wordt geanonimiseerd opgeslagen voor analyse en verbetering. Vermijd het invullen van persoonlijke gegevens.</p>
						<button onclick="publishMessage()" id="theButton">Versturen</button>
						<p id="llmStatus"></p>
						<p id="waitingTime"></p>
					    <h2>Ontvangen berichten:</h2>
					    <ul id="messages"></ul>
					</header>
				</div>
			</section>
 

<!-- min One -->
<!-- Informatie Section -->
<section id="informatie" class="wrapper style2">
  <div class="inner">
    <header class="align-center">
      <div class="box">
        <div class="content">
          <header class="align-center">
            <h3>Informatie over de imkerij</h3>
          </header>
          <p id="introductie-imkerij">Welkom op onze imkerij</p>
          <p id="promotie-aanbod">Er is geen informatie over het aanbod van verkoop en opleidingen.</p>
          <p id="activiteiten-en-agenda">Wij verzorgen de bijen het hele jaar rond</p>
          <p id="bezoekers-informatie">Vraag naar de mogelijkheden om ons te bezoeken</p>
        </div>
      </div>
    </header>
  </div>
</section>

			<!-- Official website -->
<section class="official-website-section">
  <div class="official-website-container">
    <h2 class="official-website-title">Bijenkast van sensoren voorzien?</h2>
    <p class="official-website-subtitle">Bekijk onze laagdrempelige oplossing:</p>
    <a href="https://www.smart-isolator.eu" class="official-website-link" target="_blank" rel="noopener">
      smart-isolator
    </a>
  </div>
</section>

<!-- Agenda Section (table) -->
<section id="agenda" class="wrapper style2">
  <div class="inner">
    <header class="align-center">
      <div class="box">
        <div class="content">
          <header class="align-center">
            <h3>Agenda</h3>
          </header>
          <table id="agenda-table" class="agenda-table" style="margin: 0 auto; display: none;">
            <thead>
              <tr><th>Datum & Tijd</th><th>Omschrijving</th></tr>
            </thead>
            <tbody id="agenda-tbody"></tbody>
          </table>
        </div>
      </div>
    </header>
  </div>
</section>

<!-- Gegevens Section -->
<section id="gegevens" class="wrapper style2">
  <div class="inner">
    <header class="align-center">
      <div class="box">
        <div class="content" style="padding:0;">
          <header class="align-center">
            <h3>Gegevens van de imkerij</h3>
          </header>
          <div style="display: flex; flex-direction: column; gap: 0;">
            <div style="margin:0; padding:0.1em 0;"><strong>Naam imker:</strong> <span id="naam-imker">Onbekend</span></div>
<div style="margin:0; padding:0.1em 0;"><strong>Plaats:</strong> <span id="plaats">Onbekend</span></div>
<div style="margin:0; padding:0.1em 0;"><strong>Website:</strong> <span id="website-link">Geen website</span></div>
<div style="margin:0; padding:0.1em 0;"><strong>Contact:</strong> <span id="contact-gegevens">Geen contactgegevens</span></div>
          </div>
        </div>
      </div>
    </header>
  </div>
</section>



<!-- Two -->
			<section id="two" class="wrapper style2">
				<div class="inner">
					<div class="grid-style">

						<div>
							<div class="box">
								<div class="image fit">
									<img src="images/c00001_d031_1.svg" alt="" />
								</div>
								<div class="content">
									<header class="align-center">
										<p>Het constant meten en weten! </p>
										<h2>Temperatuur</h2>
									</header>
									<p>Bekijk de sensor data binnen in de kast van de afgelopen drie dagen.</p>
									<!-- <footer class="align-center">
										<a href="#" class="button alt">TODO</a>
									</footer> -->
								</div>
							</div>
						</div>

						<div>
							<div class="box">
								<div class="image fit">
									<img src="images/c00001_d031_2.svg" alt="" />
								</div>
								<div class="content">
									<header class="align-center">
										<p>We vergelijken verschillende kasten met elkaar</p>
										<h2>Rel. luchtvochtigheid.</h2>
									</header>
									<p>Bijen houden ook van mooi weer en een schoon huis</p>
									<!-- <footer class="align-center">
										<a href="#" class="button alt">TODO</a>
									</footer>  -->
								</div>
							</div>
						</div>

					</div>
				</div>
			</section>

		<!-- Four -->
			<section id="four" class="wrapper style3">
				<div class="inner">
					<header class="align-center">
						<p>Extra informatie</p>
						<h2>Bekijk alle gegevens (afgezet tegen andere bijenkasten)</h2>
					</header>
				</div>
			</section>

		<!-- Five -->
			<section id="five" class="wrapper style2">
				<div class="inner">
					<header class="align-center">
						<p class="special">Licht intensiteit, (relatieve) luchtvochtigheid, (relatieve) luchtdruk en CO2 in de kast.</p>
						<h2>Alle grafieken</h2>
					</header>
					<div class="gallery">
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00001_d031_3.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00001_d031_4.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00001_d031_5.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00001_d031_6.svg" alt="" /></a>
							</div>
						</div>
					</div>
				</div>
			</section>

 
		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
			<script>
				const broker = "wss://uf07096f.ala.eu-central-1.emqxsl.com:8084/mqtt";
				const clientId = "mqtt_test_client_" + Math.random().toString(16).substr(2, 8);
				const options = {
					clientId: clientId,
					clean: true,
					connectTimeout: 4000,
					username: "qr_code_user", // Add your EMQX username
					password: "qr_code_password", // Add your EMQX password
					cleanSession: true,
				};

				let connectionTime;
				let messageTime;
				let waitingTime;
				let startTime;
				let waitingInterval;
				let conversationHistory = [];

				const client = mqtt.connect(broker, options);

				client.on("connect", () => {
					connectionTime = new Date().getTime();
					console.log(`Connection Time is: ${connectionTime}`);

					document.getElementById("status").textContent = "Verbonden met het bijenvolk!";
					console.log("Verbonden met de tussenman.");
					// Subscribe to unique answer topic for this client
					client.subscribe(`v000/c00001/d031/answer/${clientId}`,(err)=>{if(err)console.error("Subscribe error (answer):",err);});
					// Subscribe to insights topic and display advice with bee
					client.subscribe("v000/c00001/d031/hive_summary",(err)=>{if(err)console.error("Subscribe error (hive_summary):",err);});
					// Subscribe to honey availability topic
					client.subscribe("v000/c00001/d031/honey_availability",(err)=>{if(err)console.error("Subscribe error (honey_availability):",err);});
				});

				client.on("message", (topic, message) => {
					messageTime = new Date().getTime();
					console.log(`Tijd van bericht is: ${messageTime}`);

					// Bee advice/insights if topic matches, always display retained message
					if (topic === "v000/c00001/d031/hive_summary") {
					    const adviceContainer = document.getElementById("bee-advice-container");
					    const adviceText = document.getElementById("bee-advice-text");
					    adviceText.textContent = message.toString();
					    adviceContainer.style.display = "flex";
					    return;
					}

					// Handle honey availability messages
					if (topic === "v000/c00001/d031/honey_availability") {
        const btn = document.getElementById("honey-jar-btn");
        let data;
        try { data = JSON.parse(message.toString()); } catch (e) { btn.style.display = "none"; return; }
        const n = parseInt(data.amount, 10);
        const price = parseFloat(data.price);
        const weight = parseInt(data.weight, 10);
        const pickup = data.pickup === "yes";
        const delivery = data.delivery === "yes";
        btn.setAttribute('data-honey-information', data.information || '');
        if (!isNaN(n) && n > 0 && !isNaN(price) && price > 0 && !isNaN(weight) && weight > 0) {
            // Two-line display
            document.getElementById('honey-jar-amount').textContent = `${n} beschikbaar`;
            document.getElementById('honey-jar-details').textContent = `â‚¬${price.toFixed(2)} p.s. (${weight}g)`;
            btn.setAttribute('data-honey-price', price);
            btn.setAttribute('data-honey-weight', weight);
            btn.setAttribute('data-honey-pickup', pickup ? 'yes' : 'no');
            btn.setAttribute('data-honey-delivery', delivery ? 'yes' : 'no');
            btn.style.display = "inline-block";
        } else {
            btn.style.display = "none";
        }
        return;
					}

					// Handle Q&A messages for the unique answer topic
					if (topic === `v000/c00001/d031/answer/${clientId}`) {
						if ((messageTime - connectionTime) < 2000) {
							console.log("Bericht is van een eerder gesprek. Negeer het!");
							return;
						}
						// display the message 
						console.log(`Ontvangen bericht op topic ${topic}: ${message.toString()}`);
						displayMessage(`${message.toString()}`);
					}
				});

				function publishMessage() {
					const userInput = document.getElementById("message").value;
					if (userInput.length > 200) {
						alert("Uw vraag is te lang. Maximaal 200 tekens toegestaan.");
						return;
					}
					// previous Q&A to history (max 6 turns)
					const historyToSend = conversationHistory.slice(-6); // 3 Q&A pairs
					const jsonPayload = {
					    category: "question",
					    cat_value: userInput,
					    history: historyToSend,
					    client_id: clientId
					};
					const jsonString = JSON.stringify(jsonPayload);
					console.log("Sending:", jsonString);
					client.publish("v000/c00001/d031/user", jsonString, (err) => {
						if (err) console.error("Publish error:", err);
					});

					startTime = new Date().getTime();
					waitingInterval = setInterval(updateWaitingTime, 1000);

					document.getElementById('llmStatus').innerHTML = 'Vraag verstuurd! Verwerken van het antwoord...';
					document.getElementById("theButton").setAttribute('disabled', 'disabled');
				}

				function displayMessage(msg) {
					clearInterval(waitingInterval);
					document.getElementById("theButton").removeAttribute('disabled');

					document.getElementById('llmStatus').innerHTML = 'Antwoord ontvangen! U kunt nu een vervolg vraag stellen.';
					document.getElementById('waitingTime').innerHTML = `Antwoord gegeven in ${waitingTime} seconden`;

					const msgList = document.getElementById("messages");
					const lastUserInput = document.getElementById("message").value;
					const now = new Date();
					const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

					// Create a Q&A card
					const card = document.createElement("div");
					card.className = "qa-card";
					card.innerHTML = `
					  <div class="qa-header">${timeString}</div>
					  <div class="qa-pair">
					    <div class="qa-user"><strong>Jij:</strong> ${escapeHtml(lastUserInput)}</div>
					    <div class="qa-assistant"><strong>Assistent:</strong> ${escapeHtml(msg)}</div>
					  </div>
					`;

					// Add the new Q&A card to the top of the list
					if (msgList.firstChild) {
						msgList.insertBefore(card, msgList.firstChild);
					} else {
						msgList.appendChild(card);
					}

					// Add last Q&A to conversationHistory for memory (as role/content)
					if (lastUserInput && msg) {
						conversationHistory.push({ role: "user", content: lastUserInput });
						conversationHistory.push({ role: "assistant", content: msg });
					}
				}

				// Helper to escape HTML for safe display
				function escapeHtml(text) {
					if (!text) return '';
					return text.replace(/[&<>"']/g, function (c) {
						return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[c] || c;
					});
				}

				function updateWaitingTime() {
					const currentTime = new Date().getTime();
					waitingTime = Math.floor((currentTime - startTime) / 1000);
					document.getElementById('waitingTime').innerHTML = `Verwerkingstijd: ${waitingTime} seconden`;

					if (waitingTime > 60) {
						clearInterval(waitingInterval);
						document.getElementById('llmStatus').innerHTML = 'Het duurde te lang. Mogelijk wegens een technisch probleem.';
						document.getElementById('waitingTime').innerHTML = 'Duur van 60 seconden overschreden.';
						document.getElementById("theButton").removeAttribute('disabled');
					}
				}

				// Modal logic for honey order
				const honeyBtn = document.getElementById('honey-jar-btn');
				const honeyModal = document.getElementById('honey-order-modal');
				const honeyClose = document.getElementById('honey-order-modal-close');
				const honeyForm = document.getElementById('honey-order-form');
				const honeyConfirm = document.getElementById('honey-order-confirm');
				const honeyReviewBtn = document.getElementById('honey-order-review');
				const honeyReviewSummary = document.getElementById('honey-order-review-summary');

				function updateDeliveryOptions() {
				  const price = honeyBtn.getAttribute('data-honey-price');
				  const pickup = honeyBtn.getAttribute('data-honey-pickup') === 'yes';
				  const delivery = honeyBtn.getAttribute('data-honey-delivery') === 'yes';
				  const deliverySelect = document.getElementById('honey-delivery');
				  deliverySelect.innerHTML = '';
				  if (pickup) {
				    const opt = document.createElement('option');
				    opt.value = 'pickup';
				    opt.textContent = 'Afhalen bij de imker';
				    deliverySelect.appendChild(opt);
				  }
				  if (delivery) {
				    const opt = document.createElement('option');
				    opt.value = 'delivery';
				    opt.textContent = 'Bezorgen (adres invullen)';
				    deliverySelect.appendChild(opt);
				  }
				}

				function updateAddressFields() {
				  let addressFields = document.getElementById('honey-address-fields');
				  const deliverySelect = document.getElementById('honey-delivery');
				  const nameInput = document.getElementById('honey-name');
				  const emailInput = document.getElementById('honey-email');
				  if (!addressFields) {
				    addressFields = document.createElement('div');
				    addressFields.id = 'honey-address-fields';
				    addressFields.style.marginTop = '0.5em';
				    addressFields.innerHTML = `
				      <label for="honey-address">Adres:</label>
				      <input type="text" id="honey-address" name="honey-address" maxlength="120" required>
				      <label for="honey-postcode">Postcode:</label>
				      <input type="text" id="honey-postcode" name="honey-postcode" maxlength="12" required>
				      <label for="honey-city">Plaats:</label>
				      <input type="text" id="honey-city" name="honey-city" maxlength="40" required>
				    `;
				    const form = document.getElementById('honey-order-form');
				    form.insertBefore(addressFields, document.getElementById('honey-name'));
				  }
				  if (deliverySelect.value === 'delivery') {
				    addressFields.style.display = 'block';
				    addressFields.querySelectorAll('input').forEach(i => i.required = true);
				    // name and email required for delivery
				    if (nameInput) nameInput.required = true;
				    if (emailInput) emailInput.required = true;
				    // update labels to remove (optioneel)
				    const nameLabel = document.querySelector('label[for="honey-name"]');
				    const emailLabel = document.querySelector('label[for="honey-email"]');
				    if (nameLabel) nameLabel.innerHTML = 'Naam:';
				    if (emailLabel) emailLabel.innerHTML = 'E-mail:';
				  } else {
				    addressFields.style.display = 'none';
				    addressFields.querySelectorAll('input').forEach(i => i.required = false);
				    // name and email optional for pickup
				    if (nameInput) nameInput.required = false;
				    if (emailInput) emailInput.required = false;
				    // restore (optioneel) in labels
				    const nameLabel = document.querySelector('label[for="honey-name"]');
				    const emailLabel = document.querySelector('label[for="honey-email"]');
				    if (nameLabel) nameLabel.innerHTML = 'Naam (optioneel):';
				    if (emailLabel) emailLabel.innerHTML = 'E-mail (optioneel):';
				  }
				}

				if (honeyBtn) {
				  honeyBtn.addEventListener('click', () => {
				    // price and weight in modal if available
				    const price = honeyBtn.getAttribute('data-honey-price');
				    const weight = honeyBtn.getAttribute('data-honey-weight');
				    const delivery = honeyBtn.getAttribute('data-honey-delivery') === 'yes';
				    const priceInfo = document.querySelector('.honey-info');
				    let infoText = '';
				    if (price && priceInfo && weight) {
				      infoText = `Heerlijke lokale honing, direct van de imker! Prijs: â‚¬${parseFloat(price).toFixed(2)} per pot (${weight}g).`;
				      if (delivery) {
				        infoText += '\nVerzendkosten indicatie: ca. â‚¬7 voor 1 pot (afhankelijk van adres en aantal)';
				      }
				      priceInfo.textContent = infoText;
				    }
				    // the information field from MQTT topic in a dedicated area
				    const infoMsg = honeyBtn.getAttribute('data-honey-information') || '';
				    let infoDiv = document.getElementById('honey-info-message');
				    if (!infoDiv) {
				      infoDiv = document.createElement('div');
				      infoDiv.id = 'honey-info-message';
				      infoDiv.style = 'margin-bottom:0.7em; color:#ffd600; font-weight:500;';
				      honeyForm.parentNode.insertBefore(infoDiv, honeyForm);
				    }
				    infoDiv.textContent = infoMsg;
				    // max attribute for amount input
				    const amountInput = document.getElementById('honey-amount');
				    const maxAmount = honeyBtn.textContent.match(/^(\d+)/);
				    if (amountInput && maxAmount && maxAmount[1]) {
				      amountInput.max = maxAmount[1];
				    }
				    updateDeliveryOptions();
				    updateAddressFields();
				    document.getElementById('honey-delivery').addEventListener('change', updateAddressFields);
				    honeyModal.style.display = 'block';
				    honeyConfirm.style.display = 'none';
				    honeyForm.style.display = 'block';
				    honeyReviewSummary.style.display = 'none';
				    // reset total price display
				    const total = document.getElementById('honey-total');
				    if (total) total.textContent = '';
				  });
				}
				if (honeyClose) {
				  honeyClose.addEventListener('click', () => {
				    honeyModal.style.display = 'none';
				  });
				}
				window.addEventListener('click', (e) => {
				  if (e.target === honeyModal) honeyModal.style.display = 'none';
				});

				honeyReviewBtn.addEventListener('click', function() {
				  // gather form data
				  const amount = parseInt(document.getElementById('honey-amount').value, 10);
				  const delivery = document.getElementById('honey-delivery').value;
				  const name = document.getElementById('honey-name').value;
				  const email = document.getElementById('honey-email').value;
				  const price = honeyBtn.getAttribute('data-honey-price');
				  const weight = honeyBtn.getAttribute('data-honey-weight');
				  let address = '', postcode = '', city = '';
				  if (delivery === 'delivery') {
				    address = document.getElementById('honey-address').value;
				    postcode = document.getElementById('honey-postcode').value;
				    city = document.getElementById('honey-city').value;
				    if (!address || !postcode || !city) return;
				  }
				  if (!amount || amount < 1 || !price || !weight) return;
				  const total = (amount * parseFloat(price)).toFixed(2);
				  let summary = `<strong>Bevestig uw bestelling:</strong><br>`;
				  summary += `Aantal potten: <strong>${amount}</strong><br>`;
				  summary += `Prijs per pot: <strong>â‚¬${parseFloat(price).toFixed(2)}</strong><br>`;
				  summary += `Gewicht per pot: <strong>${weight}g</strong><br>`;
				  summary += `Totaal: <strong>â‚¬${total}</strong><br>`;
				  summary += `Afleveroptie: <strong>${delivery === 'pickup' ? 'Afhalen bij de imker' : 'Bezorgen'}</strong><br>`;
				  if (delivery === 'delivery') {
				    summary += `Adres: <strong>${address}, ${postcode}, ${city}</strong><br>`;
				  }
				  if (name) summary += `Naam: <strong>${name}</strong><br>`;
				  if (email) summary += `E-mail: <strong>${email}</strong><br>`;
				  summary += `<button id='honey-order-confirm-btn'>Bestelling bevestigen</button>`;
				  honeyReviewSummary.innerHTML = summary;
				  honeyReviewSummary.style.display = 'block';
				  honeyForm.style.display = 'none';
				  honeyConfirm.style.display = 'none';
				  // confirm button handler
				  setTimeout(() => {
				    const confirmBtn = document.getElementById('honey-order-confirm-btn');
				    if (confirmBtn) {
				      confirmBtn.onclick = function() {
				        const order = { amount, delivery, name, email };
				        if (delivery === 'delivery') {
				          order.address = address;
				          order.postcode = postcode;
				          order.city = city;
				        }
				        order.weight = weight;
				        client.publish('v000/c00001/d031/honey_order', JSON.stringify(order), (err) => {
				          if (err) {
				            honeyConfirm.textContent = 'Er is een fout opgetreden bij het versturen van uw bestelling. Probeer het later opnieuw.';
				            honeyConfirm.style.color = '#e53935';
				          } else {
				            honeyConfirm.textContent = 'Uw bestelling is verstuurd naar de imker! U ontvangt spoedig een reactie.';
				            honeyConfirm.style.color = '#388e3c';
				            honeyForm.style.display = 'none';
				            honeyReviewSummary.style.display = 'none';
				          }
				          honeyConfirm.style.display = 'block';
				        });
				      };
				    }
				  }, 100);
				});
			</script>

 
		<footer class="site-disclaimer" style="text-align:center; color:#888; font-size:0.95em; margin:2em 0 1em 0;">
  <p>
    Smart-Isolator controleert geplaatste inhoud, maar is niet verantwoordelijk voor de inhoud die door imkers wordt gepubliceerd.<br>
  </p>
  <p>Bedankt voor Uw bezoek</p>
</footer>
<script>
(function() {
  var hiveId = 'c00001_d031';
  var jsonUrl = 'https://smart-isolator.github.io/hive_info/'  + hiveId + '.json';
  fetch(jsonUrl)
    .then(function(response) { return response.json(); })
    .then(function(data) {
      // Banners
      for (var i = 1; i <= 5; i++) {
        var bannerText = data['banner' + i] || 'Het bijenvolk';
        var el = document.getElementById('banner-text-' + i);
        if (el) el.textContent = bannerText;
      }
      // Gegevens
      if (data.naam_imker) document.getElementById('naam-imker').textContent = data.naam_imker;
      if (data.plaats) {
        document.getElementById('plaats').textContent = data.plaats;
        // Also update all banner locations
        var bannerLocs = document.querySelectorAll('h2');
        for (var j = 0; j < bannerLocs.length; j++) {
          if (bannerLocs[j].textContent === 'In de buiten lucht') {
            bannerLocs[j].textContent = data.plaats;
          }
        }
      }
      if (data.website) document.getElementById('website').textContent = data.website;
      if (data.contact_gegevens) document.getElementById('contact-gegevens').textContent = data.contact_gegevens;
      // Informatie
      if (data.introductie_imkerij) document.getElementById('introductie-imkerij').textContent = data.introductie_imkerij;
      if (data.promotie_aanbod) document.getElementById('promotie-aanbod').textContent = data.promotie_aanbod;
      if (data.activiteiten_en_agenda) document.getElementById('activiteiten-en-agenda').textContent = data.activiteiten_en_agenda;
      if (data.bezoekers_informatie) document.getElementById('bezoekers-informatie').textContent = data.bezoekers_informatie;
      // Agenda
      var agenda = [];
      for (var i = 1; i <= 5; i++) {
        var text = data['agenda' + i + '_text'] || '';
        var time = data['agenda' + i + '_time'] || '';
        if (text && text.trim() && time && time.trim()) {
          agenda.push({ text: text, time: time });
        }
      }
      console.log('Agenda array:', agenda); // Debug line
      var tbody = document.getElementById('agenda-tbody');
      if (agenda.length > 0 && tbody) {
        tbody.innerHTML = '';
        agenda.forEach(function(item) {
          var tr = document.createElement('tr');
          var tdTime = document.createElement('td');
          tdTime.textContent = item.time;
          var tdText = document.createElement('td');
          tdText.textContent = item.text;
          tr.appendChild(tdTime);
          tr.appendChild(tdText);
          tbody.appendChild(tr);
        });
        document.getElementById('agenda-table').style.display = '';
      }
    })
    .catch(function(err) {
      // If fetch fails, keep the default text
    });
})();
</script>
<script>
// Dynamically update the page title to include the imker name from gegevens
(function() {
  var updateTitle = function() {
    var naamImker = document.getElementById('naam-imker');
    if (naamImker && naamImker.textContent.trim()) {
      document.title = 'De bijenkast van binnen: ' + naamImker.textContent.trim();
    }
  };
  // Run after gegevens are loaded
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(updateTitle, 500); // Wait for gegevens to be filled
  } else {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(updateTitle, 500);
    });
  }
})();
</script>
<script>
// Dynamically update the honey order modal title with the imker name
(function() {
  var updateHoneyTitle = function() {
    var naamImker = document.getElementById('naam-imker');
    var honeyTitle = document.getElementById('honey-order-title');
    if (naamImker && naamImker.textContent.trim() && honeyTitle) {
      honeyTitle.textContent = 'Honing bestellen bij ' + naamImker.textContent.trim();
    }
  };
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(updateHoneyTitle, 600); // Wait for gegevens to be filled
  } else {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(updateHoneyTitle, 600);
    });
  }
})();
</script>
<script>
(function() {
  var hiveId = 'c00001_d031';
  var jsonUrl = 'https://smart-isolator.github.io/hive_info/'  + hiveId + '.json';
  fetch(jsonUrl)
    .then(function(response) { return response.json(); })
    .then(function(data) {
      // Update website link text and href dynamically
      var websiteSpan = document.getElementById('website-link');
      if (websiteSpan) {
        if (data.website && data.website.trim() && data.website !== 'Geen website') {
          websiteSpan.innerHTML = '<a href="' + data.website + '" target="_blank" rel="noopener">Link</a>';
        } else {
          websiteSpan.textContent = 'Geen website';
        }
      }
    })
    .catch(function(err) {
      // If fetch fails, keep the default text
    });
})();
</script>
<div class="thermometer-banner" style="position: fixed; top: 100px; left: 20px; z-index: 1000;">
  <div class="thermometer">
    <div id="thermometer-fluid" class="thermometer-fluid"></div>
  </div>
  <p id="thermometer-label" class="thermometer-label">Bijenvolk: c00001_d031</p>
  <p id="thermometer-timestamp" class="thermometer-timestamp"></p>
</div>

<style>
  .thermometer {
    width: 30px;
    height: 100px;
    border: 2px solid #000;
    border-radius: 15px;
    position: relative;
    background: #fff;
  }
  .thermometer-fluid {
    width: 100%;
    position: absolute;
    bottom: 0;
    background: red;
    border-radius: 15px;
  }
  .thermometer-label {
    margin-top: 10px;
    font-size: 14px;
    text-align: center;
  }
  .thermometer-timestamp {
    margin-top: 5px;
    font-size: 12px;
    text-align: center;
    color: gray;
  }
</style>

<script>
  async function updateThermometer() {
    const hiveId = "c00001_d031_temp_hive"; // Use the hive ID parameter
    const csvUrl = "hive_data.csv"; // URL to the CSV file

    try {
      const response = await fetch(csvUrl);
      const csvText = await response.text();
      const rows = csvText.split("\n").filter(row => row.trim() !== ""); // Remove empty rows
      const headers = rows[0].split(","); // Use commas for CSV parsing
      const hiveIndex = headers.indexOf(hiveId);
      const datetimeIndex = headers.indexOf("datetime");

      console.log("Headers:", headers);
      console.log("Hive Index:", hiveIndex);

      if (hiveIndex === -1 || datetimeIndex === -1) {
        console.error(`Hive ID ${hiveId} or datetime not found in CSV headers.`);
        return;
      }

      // Find the latest valid row
      let latestRow;
      for (let i = rows.length - 1; i > 0; i--) {
        const row = rows[i].split(",");
        if (row[hiveIndex] && !isNaN(parseFloat(row[hiveIndex]))) {
          latestRow = row;
          break;
        }
      }

      console.log("Latest Row:", latestRow);

      if (!latestRow) {
        console.error("No valid rows found in CSV.");
        return;
      }

      const temperature = parseFloat(latestRow[hiveIndex]);
      const timestamp = latestRow[datetimeIndex];

      console.log("Temperature Value:", temperature);

      if (!isNaN(temperature)) {
        const percentage = Math.min(Math.max((temperature / 50) * 100, 0), 100); // Scale temperature to percentage
        document.getElementById("thermometer-fluid").style.height = `${percentage}%`;
        document.getElementById("thermometer-label").textContent = `Bijenvolk: ${temperature.toFixed(1)}Â°C`;
        document.getElementById("thermometer-timestamp").textContent = `Laatste meting: ${timestamp}`;
      } else {
        console.error("Invalid temperature value.");
      }
    } catch (error) {
      console.error("Error fetching or processing CSV data:", error);
    }
  }

  updateThermometer();
</script>
	</body>
</html>