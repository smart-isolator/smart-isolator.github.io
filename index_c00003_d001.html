<!DOCTYPE HTML>
<html>
	<head>
		<title>Understanding the Hive in: Bijenkast v001/c00003/d001</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body>

		<!-- Header -->
			<header id="header" class="alt">
				<div class="logo"><a href="https://smart-isolator.github.io/indexc00003_d001.html"><span>Home</span></a></div>
				<a href="#menu">Menu</a>
			</header>

		<!-- Nav -->
			<nav id="menu">
				<ul class="links">
					<li><a href=" https://smart-isolator.github.io/indexc00003_d001.html ">Home</a></li>
					<li><a href="credits.html">Credits</a></li>
				</ul>
			</nav>

		<!-- Banner -->
			<section class="banner half">
				<article>
					<img src="images/c00003_d001_1.jpg" alt="" />
					<div class="inner">
						<header>
							<p>Automatisch gegenereerde content</p>
							<h2>Bijenkast v001/c00003/d001</h2>
						</header>
					</div>
				</article>
				<article>
					<img src="images/c00003_d001_2.jpg" alt="" />
					<div class="inner">
						<header>
							<p>...</p>
							<h2>Bijenkast v001/c00003/d001</h2>
						</header>
					</div>
				</article>
				<article>
					<img src="images/c00003_d001_3.jpg"  alt="" />
					<div class="inner">
						<header>
							<p>...</p>
							<h2>Bijenkast v001/c00003/d001</h2>
						</header>
					</div>
				</article>
				<article>
					<img src="images/{hive_id}_4.jpg"  alt="" />
					<div class="inner">
						<header>
							<p>...</p>
							<h2>Bijenkast v001/c00003/d001</h2>
						</header>
					</div>
				</article>
				<article>
					<img src="images/c00003_d001_5.jpg"  alt="" />
					<div class="inner">
						<header>
							<p>...</p>
							<h2>Bijenkast v001/c00003/d001</h2>
						</header>
					</div>
				</article>
			</section>
 
<!-- One -->
			<section id="one" class="wrapper style3">
				<div class="inner">
					<header class="align-center">
					    <p><strong>Status:</strong> <span id="status">Connecting...</span></p>
					    <input type="text" id="message" placeholder="Ask your question to the beehive!">
					    <button onclick="publishMessage()" id="theButton">Send</button>
						<p id="llmStatus"></p>
						<p id="waitingTime"></p>
					    <h2>Received Messages:</h2>
					    <ul id="messages"></ul>
					</header>
				</div>
			</section>
 




<!-- Two -->
			<section id="two" class="wrapper style2">
				<div class="inner">
					<header class="align-center">



						<div>
							<div class="box">
								
								<div class="content">
									<header class="align-center">
										<p>{introduction_apiary}</p>
									</header>
									<p>Temperatuur & licht</p>
									<a href="https://smart-isolator.github.io/indexc00003_d001.html">Visit our homepage</a>
									<footer class="align-center">
										<a href="#" class="button alt">TODO</a>
									</footer>
								</div>
							</div>
						</div>

					</div>
				</div>
			</section>
 


		<!-- Three -->
			<section id="one" class="wrapper style2">
				<div class="inner">
					<div class="grid-style">

						<div>
							<div class="box">
								<div class="image fit">
									<img src="images/c00003_d001_1.svg" alt="" />
								</div>
								<div class="content">
									<header class="align-center">
										<p>Het project </p>
										<h2>Beehive Monitoring System Overview</h2>
									</header>
									<p>{tech_story}</p>
									<footer class="align-center">
										<a href="#" class="button alt">TODO</a>
									</footer>
								</div>
							</div>
						</div>

						<div>
							<div class="box">
								<div class="image fit">
									<img src="images/c00003_d001_2.svg" alt="" />
								</div>
								<div class="content">
									<header class="align-center">
										<p>Data</p>
										<h2>Temperature (against other hives)</h2>
									</header>
									<p>Bijen houden ook van mooi weer en een schoon huis</p>
									<footer class="align-center">
										<a href="#" class="button alt">TODO</a>
									</footer>
								</div>
							</div>
						</div>

					</div>
				</div>
			</section>

		<!-- Four -->
			<section id="four" class="wrapper style3">
				<div class="inner">
					<header class="align-center">
						<p>Extra informatie</p>
						<h2>Bekijk alle gegevens (afgezet tegen andere bijenkasten)</h2>
					</header>
				</div>
			</section>

		<!-- Five -->
			<section id="five" class="wrapper style2">
				<div class="inner">
					<header class="align-center">
						<p class="special">(relatieve) luchtvochtigheid, licht, (relatieve) luchtdruk en Temperatuur verschil binnen en buiten de kast</p>
						<h2>Alle grafieken</h2>
					</header>
					<div class="gallery">
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00003_d001_3.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00003_d001_4.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00003_d001_5.svg" alt="" /></a>
							</div>
						</div>
						<div>
							<div class="image fit">
								<a href="#"><img src="images/c00003_d001_6.svg" alt="" /></a>
							</div>
						</div>
					</div>
				</div>
			</section>

 
		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
		<script>
		        const broker = "wss://uf07096f.ala.eu-central-1.emqxsl.com:8084/mqtt";
		        const clientId = "mqtt_test_client_" + Math.random().toString(16).substr(2, 8);
		        const options = {
				clientId: clientId,
				clean: true,
				connectTimeout: 4000,
				username: "qr_code_user", // Add your EMQX username
			    password: "qr_code_password", // Add your EMQX password
				cleanSession: true,
		        };
				// create timer constants
				let connectionTime;
				let messageTime;
				let waitingTime;
				let startTime;
				let waitingInterval;
				
		        const client = mqtt.connect(broker, options);
		
		        client.on("connect", () => {
					// record timestamp of making the connection
					connectionTime = new Date().getTime();
					console.log(`Connection Time is: ${connectionTime}`);
					
		            document.getElementById("status").textContent = "Connected to the hive!";
		            console.log("Connected to MQTT Broker");
		            client.subscribe("c00003_d001/answer", (err) => {
		                if (err) console.error("Subscribe error:", err);
		            });
		        });
 
				client.on("message", (topic, message) => {
					// find the message timestamp
					messageTime = new Date().getTime();
					console.log(`Message Time is: ${messageTime}`);
					
					// only display message when it is not from a previous interaction
					if ((messageTime - connectionTime) < 2000 ) {
						console.log('Message is from a previous interaction. Ignore!');
						return;
					}
					
					//display the message 
		            console.log(`Received message on topic ${topic}: ${message.toString()}`);
		            displayMessage(`${message.toString()}`);
		        });
 
		        function publishMessage() {
		            const userInput = document.getElementById("message").value;
		            const jsonPayload = {
		                category: "question",
		                cat_value: userInput
		            };
		            const jsonString = JSON.stringify(jsonPayload);
		            console.log("Sending:", jsonString);
		            client.publish("c00003_d001/user", jsonString, (err) => {
		                if (err) console.error("Publish error:", err);
		            });
					
					// Start waiting time
					startTime = new Date().getTime();
					waitingInterval = setInterval(updateWaitingTime, 1000);

					// Show message that the question has been sent
					document.getElementById('llmStatus').innerHTML = 'Question sent! Processing reply...';
					
					//disable the button
					document.getElementById("theButton").setAttribute('disabled','disabled');
		        }
		
		        function displayMessage(msg) {
					// clear timer interval, because answer has arrived
					clearInterval(waitingInterval);
					
					//enable the button again
					document.getElementById("theButton").removeAttribute('disabled');
					
					//update status and waiting timer
					document.getElementById('llmStatus').innerHTML = 'Answer received! You can now ask follow-up questions.';
					document.getElementById('waitingTime').innerHTML = `Answer given in ${waitingTime} seconds`;

		            const msgList = document.getElementById("messages");
		            const newItem = document.createElement("li");
		            newItem.textContent = msg;
		            msgList.appendChild(newItem);
		        }
				
				function updateWaitingTime() {
					const currentTime = new Date().getTime();
					waitingTime = Math.floor((currentTime - startTime) / 1000);
					document.getElementById('waitingTime').innerHTML = `Processing Time: ${waitingTime} seconds`;
					
					//if more than 60 seconds have passed, give message about technical difficulties
					if (waitingTime > 60) { 
						//stop the interval checking
						clearInterval(waitingInterval);
						// give message about the technical issues
						document.getElementById('llmStatus').innerHTML = 'Waitingtime too long. We might be experiencing technical issues';
						document.getElementById('waitingTime').innerHTML = 'Limit of 60 seconds exceeded';

						//enable the button again
						document.getElementById("theButton").removeAttribute('disabled');
					}
				}
		    </script>

 
	</body>
</html>